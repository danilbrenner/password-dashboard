unit_tests:
  - name: test_fact_login_passwords_latest_login_session
    model: fact_login_passwords

    given:
      - input: ref('fact_exchange_sessions')
        rows:
          - { export_ts: "2025-10-12 15:45:36", session_type: "login", count: 2 }
          - { export_ts: "2025-11-01 12:00:00", session_type: "login", count: 1 }
          - { export_ts: "2025-09-01 00:00:00", session_type: "master_password", count: 1 }

      - input: ref('stg_in_logins')
        rows:
          - { id: "851f5f8f-d212-6c43-ff93-bb301c424bf4", strength: "Moderate", changed_at: "2025-10-10 10:00:00", export_ts: "2025-10-12 15:45:36" }
          - { id: "c3f00e17-c182-83d9-a027-e32ac5a27bd3", strength: "VeryStrong", changed_at: "2025-11-01 08:30:00", export_ts: "2025-11-01 12:00:00" }
          - { id: "00000000-0000-0000-0000-000000000000", strength: "Strong", changed_at: "2025-10-12 11:00:00", export_ts: "2025-10-12 15:45:36" }

    expect:
      rows:
        - { login_id: "c3f00e17-c182-83d9-a027-e32ac5a27bd3", strength: "VeryStrong", changed_at: "2025-11-01 08:30:00" }

    overrides:
      macros:
        is_incremental: false

