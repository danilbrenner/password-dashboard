unit_tests:
  - name: test_stg_in_logins_export_ts_parsing
    model: stg_in_logins

    given:
      - input: ref('raw_logins')
        rows:
          - {
            id: "851f5f8f-d212-6c43-ff93-bb301c424bf4",
            name: "Alice",
            username: "alice@example.com",
            changed_at: "2025-10-10 10:00:00",
            strength: 80,
            filename: "azure://password-dashboard/20251012154536/logins.csv"
          }
          - {
            id: "c3f00e17-c182-83d9-a027-e32ac5a27bd3",
            name: "Bob",
            username: "bob@example.com",
            changed_at: "2025-11-01 08:30:00",
            strength: 50,
            filename: "azure://password-dashboard/20251101120000/logins.csv"
          }

    expect:
      rows:
        - {
          id: "851f5f8f-d212-6c43-ff93-bb301c424bf4",
          name: "Alice",
          username: "alice@example.com",
          changed_at: "2025-10-10 10:00:00",
          strength: 80,
          export_ts: "2025-10-12 15:45:36"
        }
        - {
          id: "c3f00e17-c182-83d9-a027-e32ac5a27bd3",
          name: "Bob",
          username: "bob@example.com",
          changed_at: "2025-11-01 08:30:00",
          strength: 50,
          export_ts: "2025-11-01 12:00:00"
        }
    
    overrides:
      macros:
        is_incremental: false